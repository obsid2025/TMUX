# ==================== SETARI DE BAZA ====================

# Prefix: Ctrl+a (nou) SI Ctrl+b (vechi) - ambele functioneaza
set -g prefix C-a
set -g prefix2 C-b
bind C-a send-prefix
bind C-b send-prefix -2

# Mouse support (click pe pane, scroll, resize)
set -g mouse on

# IMPORTANT: Dezactiveaza meniurile contextuale pe click dreapta
# Asta permite terminalului sa gestioneze click dreapta (paste)
unbind -T root MouseDown3Pane
unbind -T root MouseDown3Status
unbind -T root MouseDown3StatusLeft
unbind -T root M-MouseDown3Pane
unbind -T root M-MouseDown3Status
unbind -T root M-MouseDown3StatusLeft

# Click dreapta = paste din clipboard-ul tmux (optional)
# bind -T root MouseDown3Pane paste-buffer

# Ctrl+V = paste din Windows clipboard (ca pe Windows!)
bind -n C-v run "tmux set-buffer -- \"$(powershell.exe -NoProfile -Command Get-Clipboard | tr -d '\r')\" && tmux paste-buffer"

# Copiere automata la Windows clipboard cand selectezi cu mouse-ul
bind -T copy-mode MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "clip.exe"
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "clip.exe"

# Ctrl+C in copy-mode = copiaza la Windows clipboard si iesi
bind -T copy-mode C-c send-keys -X copy-pipe-and-cancel "clip.exe"
bind -T copy-mode-vi C-c send-keys -X copy-pipe-and-cancel "clip.exe"

# Indexare de la 1 (nu de la 0) - mai intuitiv
set -g base-index 1
setw -g pane-base-index 1

# Renumeroteaza ferestrele cand inchizi una
set -g renumber-windows on

# Nu redenumi ferestrele automat
set -g allow-rename off
set -g automatic-rename off

# History mai mare (scroll back)
set -g history-limit 50000

# Escape time mai mic (pentru nvim/vim)
set -sg escape-time 0

# 256 culori + true color support
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Dezactiveaza secventele OSC care cauzeaza probleme
set -g allow-passthrough off

# ==================== SHORTCUT-URI INTUITIVE ====================

# Split cu | si - (mai intuitiv decat % si ")
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Pastreaza si shortcut-urile vechi dar cu path curent
bind % split-window -h -c "#{pane_current_path}"
bind '"' split-window -v -c "#{pane_current_path}"

# Fereastra noua in directorul curent
bind c new-window -c "#{pane_current_path}"

# Navigare intre pane-uri cu Alt+sageti (FARA prefix!)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Resize pane-uri cu Ctrl+sageti (FARA prefix!)
bind -n C-Left resize-pane -L 2
bind -n C-Right resize-pane -R 2
bind -n C-Up resize-pane -U 2
bind -n C-Down resize-pane -D 2

# Schimba ferestre cu Shift+sageti (FARA prefix!)
bind -n S-Left previous-window
bind -n S-Right next-window

# Reload config rapid cu prefix + r
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Sync panes (scrii in toate odata) - toggle cu prefix + S
bind S setw synchronize-panes

# Kill pane fara confirmare
bind x kill-pane

# ==================== CATPPUCCIN THEME ====================

# Incarca plugin-uri extra INAINTE de Catppuccin
run ~/.config/tmux/plugins/tmux-plugins/tmux-cpu/cpu.tmux
run ~/.config/tmux/plugins/tmux-plugins/tmux-battery/battery.tmux

# Flavor: latte (light), frappe, macchiato, mocha (darkest)
set -g @catppuccin_flavor "macchiato"

# Stil ferestre
set -g @catppuccin_window_status_style "rounded"

# Afiseaza numele ferestrei (#W) nu hostname-ul (#T)
set -g @catppuccin_window_text " #W"
set -g @catppuccin_window_current_text " #W"

# Pane borders - etichete SUS
# Activ = highlight roz, Inactiv = text alb
set -g pane-border-status top
set -g pane-border-style "fg=#494d64"
set -g pane-active-border-style "fg=#c6a0f6"
set -g pane-border-format "#[align=centre]#{?pane_active,#[fg=#1e2030#,bg=#c6a0f6#,bold] #{pane_index}:#{pane_title} #[default],#[fg=#cad3f5] #{pane_index}:#{pane_title} #[default]}"

# Tree view (prefix+w) - arată titlul pane-ului
bind w choose-tree -ZwF "#{window_index}:#{window_name} │ #{pane_index}:#{pane_title}"
bind s choose-tree -ZsF "#{session_name}: #{session_windows} windows"

# Incarca tema Catppuccin
run ~/.config/tmux/plugins/catppuccin/tmux/catppuccin.tmux

# Status bar SUS
set -g status-position top

# Ferestre clickable
set -g mouse on

# Status bar - ferestre stanga, info dreapta
set -g status-left-length 100
set -g status-right-length 300
set -g status-left ""
set -g status-right "#[fg=#8aadf4] W: #[fg=#eed49f]CPU #(~/.local/bin/win_cpu.sh)%% #[fg=#f5bde6]RAM #(~/.local/bin/win_ram.sh)%% #[fg=#a6da95]│ WSL: #[fg=#eed49f]CPU #(~/.config/tmux/plugins/tmux-plugins/tmux-cpu/scripts/cpu_percentage.sh) #[fg=#f5bde6]RAM #(~/.config/tmux/plugins/tmux-plugins/tmux-cpu/scripts/ram_percentage.sh) #[fg=#cad3f5]│   #{pane_current_path} #{E:@catppuccin_status_session}#{E:@catppuccin_status_date_time}"

# ==================== PLUGINS ====================

# Tmux Plugin Manager (TPM)
set -g @plugin 'tmux-plugins/tpm'

# tmux-resurrect - salvare/restaurare manuala sesiuni
set -g @plugin 'tmux-plugins/tmux-resurrect'

# tmux-continuum - salvare automata + restaurare la pornire
set -g @plugin 'tmux-plugins/tmux-continuum'

# Activeaza restaurarea automata la pornirea tmux
set -g @continuum-restore 'on'

# Salveaza sesiunea la fiecare 15 minute
set -g @continuum-save-interval '15'

# Salveaza si continutul pane-urilor (optional, dar util)
set -g @resurrect-capture-pane-contents 'on'

# Pane borders - stilul e setat de Catppuccin mai sus

# Initializeaza TPM (trebuie sa fie ultima linie)
run '~/.tmux/plugins/tpm/tpm'
